---
title: "Plotando o CAR para CMA"
author: "PFFernandes"
date: "30/06/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introdução:
Nesse script buscamos realizar o download dos dados shapefile do Cadastro Ambiental Rural(CAR) para o municipio de Campina do Monte Alegre do site "http://www.car.gov.br/publico/imoveis/index", carregar, plotar e realizar algumas analises.

#### Comando para checar se existem os pacotes em seu PC e baixar caso não possua:
```{r}
list.of.packages <- c("raster", "sp", "rgdal", "dplyr", "XML", "curl")

new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) 

install.packages(new.packages)
```

#### Comando para carregar os pacotes:
```{r, message=FALSE, warning=FALSE}
require(raster)
require(sp)
require(rgdal)
require(dplyr)
require(XML)
require(curl)
```

#### Acessar o site e baixar os dados do CAR para Campina do Monte Alegre:
Aqui n consegui de jeito nenhum achar uma forma de baixar direto do site...

#### Carregar o mapa para o R:
```{r,warning=FALSE,message=FALSE,results='hide'}
CMA_car<-readOGR(dsn="../DATA_USE/AREA_IMOVEL",layer="AREA_IMOVEL")
```

#### Visualizar o mapa:
```{r}
plot(CMA_car)
```

#### Acessar o dataframe:
```{r,results='hide'}
CMA_car@data
```

#### Acessando as informações mais importantes: 
```{r,results='hide'}
# Número de áreas
CMA_car@data[["NUM_AREA"]]
```

```{r,results='hide'}
# Número de módulos fiscais
CMA_car@data[["NUM_MODULO"]]
```

### Agora plotaremos o mapa utilizando o número de módulos fiscais (NUM_MODULO) para o municipio de Campina do Monte Alegre, levando em conta que cada 22 hectares corresponde a 1 módulo fiscal de acordo com o INCRA

#### Primeiro tenhamos algo em mente quanto a classificação do imovel rural:
##### - Pequena Propriedade - Imóvel rural de até 4 módulos fiscais;
##### - Média Propriedade - Área superior a 4 e até 15 módulos fiscais;
##### - Grande Propriedade - Área superior a 15 módulos fiscais.

## Plotando o mapa:
```{r,fig.align='center',fig.width=6,fig.height=6}
plot(CMA_car, col = "transparent", border="transparent", main="Classificação dos Imóveis Rurais de CMA")

# Pequenas propriedades, apenas os n° módulos menores(<) ou iguais(==) 4
peq_prop <- CMA_car@data$NUM_MODULO <= 4
plot(CMA_car[peq_prop,], col = "dark green", border="transparent", add=TRUE)

# Médias propriedades, apenas os n° maaiores(>) que 4
med_prop <- CMA_car@data$NUM_MODULO > 4
# E (&) os n° módulos menores(<) e iguais(==) 15
med_prop1 <- CMA_car@data$NUM_MODULO <= 15
plot(CMA_car[med_prop&med_prop1,], col = "yellow", border="transparent", add=TRUE)

# Grandes propriedades, apenas os n° módulos maiores(>) que 15 
gra_prop <- CMA_car@data$NUM_MODULO > 15
plot(CMA_car[gra_prop,], col = "red", border="transparent", add=TRUE)

legend("topright", c("Pequenas", "Médias", "Grandes"), fill=c("dark green", "yellow", "red"))

axis(1)
axis(2)

```

#### Plotando separadamente:
```{r,fig.align='center'}
par(mfrow=c(1,3))

# Pequenas
plot(CMA_car, col = "transparent", border="transparent")
peq_prop <- CMA_car@data$NUM_MODULO <= 4
plot(CMA_car[peq_prop,], col = "dark green", border="transparent", add=TRUE)
legend("topright", "Pequenas", fill="dark green")

# Médias
plot(CMA_car, col = "transparent", border="transparent")
med_prop <- CMA_car@data$NUM_MODULO > 4
med_prop1 <- CMA_car@data$NUM_MODULO <= 15
plot(CMA_car[med_prop&med_prop1,], col = "yellow", border="transparent", add=TRUE)
legend("topright", "Médias", fill="yellow")

# Grandes
plot(CMA_car, col = "transparent", border="transparent")
gra_prop <- CMA_car@data$NUM_MODULO > 15
plot(CMA_car[gra_prop,], col = "red", border="transparent", add=TRUE)
legend("topright", "Grandes", fill="red")

```
Existem algumas sobreposições nos mapas .....


## Analises:

#### Quantidade total de área/hectares??:
```{r}
sum(CMA_car@data$NUM_AREA)
```


