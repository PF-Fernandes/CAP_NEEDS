---
title: "Barão de Antonina"
author: "PFFernandes"
date: "11/07/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introdução:
Nesse script buscamos analisar os dados shapefile do Cadastro Ambiental Rural(CAR) para o municipio de Barão de Antonina (com 20 ha = 1 módulo rural) do site "http://www.car.gov.br/publico/imoveis/index", carregar, plotar e realizar algumas analises.

#### Comando para checar se existem os pacotes em seu PC e baixar caso não possua:
```{r}
list.of.packages <- c("raster", "sp", "rgdal", "dplyr", "XML", "curl")

new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) 

install.packages(new.packages)
```

#### Comando para carregar os pacotes:
```{r, message=FALSE, warning=FALSE}
require(raster)
require(sp)
require(rgdal)
require(dplyr)
require(XML)
require(curl)
```

#### Carregar o mapa para o R:
```{r,warning=FALSE,message=FALSE,results='hide'}
# Barão de Antonina
BARAO_car<-readOGR(dsn="../DATA_USE/CAR/Barão_de_Antonina",layer="AREA_IMOVEL")
```

#### Visualizar o mapa:
```{r}
plot(BARAO_car)
```

### Agora plotaremos o mapa utilizando o número de módulos fiscais (NUM_MODULO)
#### Primeiro tenhamos algo em mente quanto a classificação do imovel rural:
##### - Pequena Propriedade - Imóvel rural de até 4 módulos fiscais;
##### - Média Propriedade - Área superior a 4 e até 15 módulos fiscais;
##### - Grande Propriedade - Área superior a 15 módulos fiscais.

## Plotando:
#### Plotando Barão de Antonina:
```{r,fig.align='center',fig.width=6,fig.height=6}
plot(BARAO_car, col = "transparent", border="transparent", main="Barão de Antonina")

# Pequenas propriedades, apenas os n° módulos menores(<) ou iguais(==) 4
peq_prop <- BARAO_car@data$NUM_MODULO <= 4
plot(BARAO_car[peq_prop,], col = "dark green", border="transparent", add=TRUE)

# Médias propriedades, apenas os n° maiores(>) que 4
med_prop <- BARAO_car@data$NUM_MODULO > 4
# E (&) os n° módulos menores(<) e iguais(==) 15
med_prop1 <- BARAO_car@data$NUM_MODULO <= 15
plot(BARAO_car[med_prop&med_prop1,], col = "yellow", border="transparent", add=TRUE)

# Grandes propriedades, apenas os n° módulos maiores(>) que 15 
gra_prop <- BARAO_car@data$NUM_MODULO > 15
plot(BARAO_car[gra_prop,], col = "red", border="transparent", add=TRUE)

legend("topright", c("Pequenas", "Médias", "Grandes"), fill=c("dark green", "yellow", "red"))
axis(1)
axis(2)
```

#### Plotando separadamente para observar sobreposições:
```{r,fig.align='center'}
par(mfrow=c(1,3))

# Pequenas
plot(BARAO_car, col = "transparent", border="transparent")
peq_prop <- BARAO_car@data$NUM_MODULO <= 4
plot(BARAO_car[peq_prop,], col = "dark green", border="transparent", add=TRUE)
legend("topright", "Pequenas", fill="dark green")

# Médias
plot(BARAO_car, col = "transparent", border="transparent")
med_prop <- BARAO_car@data$NUM_MODULO > 4
med_prop1 <- BARAO_car@data$NUM_MODULO <= 15
plot(BARAO_car[med_prop&med_prop1,], col = "yellow", border="transparent", add=TRUE)
legend("topright", "Médias", fill="yellow")

# Grandes
plot(BARAO_car, col = "transparent", border="transparent")
gra_prop <- BARAO_car@data$NUM_MODULO > 15
plot(BARAO_car[gra_prop,], col = "red", border="transparent", add=TRUE)
legend("topright", "Grandes", fill="red")
```
Existem algumas sobreposições nos mapas ????

## Analises:

#### Quantidade total de imoveis rurais:
```{r}
nrow(BARAO_car)
n_prop<- nrow(BARAO_car)
```

#### Quantidades de pequenas propriedades:
```{r}
sum(peq_prop)

# Porcentagem
n_p<- sum(peq_prop)
(n_p/n_prop)*100 
```

#### Quantidade de imoveis de médias propriedades:
```{r}
sum(med_prop&med_prop1)

# Porcentagem
n_m<- sum(med_prop&med_prop1)
(n_m/n_prop)*100 
```

#### Quantidade de imoveis de grandes propriedades:
```{r}
sum(gra_prop)

# Porcentagem
n_g<- sum(gra_prop)
(n_g/n_prop)*100 
```

###############################################################################


#### Quantidade total de área/hectares:
```{r}
sum(BARAO_car@data$NUM_AREA)
ha<- sum(BARAO_car@data$NUM_AREA)
```

#### Quantidade total de área/hectares de pequenas propriedades:
```{r}
ha_peq_prop <- BARAO_car[BARAO_car@data$NUM_AREA <= 80.000000,]
sum(ha_peq_prop@data$NUM_AREA)

# Porcentagem
ha_p<- sum(ha_peq_prop@data$NUM_AREA)
(ha_p/ha)*100 
```

#### Quantidade total de área/hectares de médias propriedades:
```{r}
ha_med_prop <- BARAO_car@data$NUM_AREA > 80.000000
ha_med1_prop<- BARAO_car@data$NUM_AREA <= 300.000000
ha_med2_prop <- BARAO_car[ha_med_prop&ha_med1_prop,]
sum(ha_med2_prop@data$NUM_AREA)

# Porcentagem
ha_m<- sum(ha_med2_prop@data$NUM_AREA)
(ha_m/ha)*100 
```

#### Quantidade total de área/hectares de grandes propriedades:
```{r}
ha_gra_prop <- BARAO_car[BARAO_car@data$NUM_AREA > 300.000000,]
sum(ha_gra_prop@data$NUM_AREA)

# Porcentagem
ha_g<- sum(ha_gra_prop@data$NUM_AREA)
(ha_g/ha)*100 
```


